<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã‚¿ã‚¹ã‚¯ç·¨é›† - Todoç®¡ç†</title>
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>
    <div class="container">
        <div class="main-card">
            <!-- ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== -->
            <div class="header-section">
                <div class="header-left">
                    <h1>âœï¸ ã‚¿ã‚¹ã‚¯ç·¨é›†</h1>
                </div>
                <div class="header-right">
                    <button id="darkModeToggle" onclick="toggleDarkMode()" class="header-button">ğŸŒ™ ãƒ€ãƒ¼ã‚¯</button>
                    <a href="{{ url_for('home') }}" class="header-button">â† æˆ»ã‚‹</a>
                </div>
            </div>

            <!-- ===== ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ ===== -->
            <div class="main-content">
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                    <div class="flashes">
                        {% for message in messages %}
                        <div class="flash-message">{{ message }}</div>
                        {% endfor %}
                    </div>
                    {% endif %}
                {% endwith %}

                <div class="add-form">
                    <form method="POST" action="/edit/{{ todo.id }}">
                        <!-- ã‚¿ã‚¹ã‚¯å -->
                        <div class="form-row">
                            <div class="form-group" style="grid-column: span 1;">
                                <label for="title">ğŸ“ ã‚¿ã‚¹ã‚¯å</label>
                                <input 
                                    type="text" 
                                    name="title" 
                                    id="title" 
                                    value="{{ todo.title }}{% if todo.tags %}{% for tag in todo.tags.split(',') %} #{{ tag.strip() }}{% endfor %}{% endif %}" 
                                    required
                                    placeholder="ä¾‹ï¼šãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™ä½œæˆ"
                                >
                            </div>
                        </div>

                        <!-- æœŸé™ãƒ»æ™‚é–“ãƒ»å„ªå…ˆåº¦ -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="due_date">ğŸ“… æœŸé™æ—¥</label>
                                <input 
                                    type="date" 
                                    name="due_date" 
                                    id="due_date"
                                    value="{{ todo.due_date }}"
                                >
                            </div>
                            <div class="form-group">
                                <label for="due_time">â° æ™‚é–“</label>
                                <input 
                                    type="time" 
                                    name="due_time" 
                                    id="due_time"
                                    value="{{ todo.due_time }}"
                                >
                            </div>
                            <div class="form-group">
                                <label for="priority">ğŸ¯ å„ªå…ˆåº¦</label>
                                <select name="priority" id="priority">
                                    <option value="low" {% if todo.priority == 'low' %}selected{% endif %}>ğŸŸ¡ ä½</option>
                                    <option value="medium" {% if todo.priority == 'medium' %}selected{% endif %}>ğŸŸ  ä¸­</option>
                                    <option value="high" {% if todo.priority == 'high' %}selected{% endif %}>ğŸ”´ é«˜</option>
                                </select>
                            </div>
                        </div>

                        <!-- ç¹°ã‚Šè¿”ã—è¨­å®š -->
                        <div class="form-group">
                            <label style="display: flex; align-items: center; font-weight: 500; cursor: pointer;">
                                <input type="checkbox" id="is_recurring" name="is_recurring" onchange="toggleRecurrenceOptions()" {% if todo.is_recurring %}checked{% endif %}>
                                <span style="margin-left: 10px;">ğŸ”„ ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯</span>
                            </label>
                        </div>

                        <div id="recurrenceOptions" class="recurrence-options" style="{% if not todo.is_recurring %}display: none;{% endif %}">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="recurrence_type">ãƒ‘ã‚¿ãƒ¼ãƒ³</label>
                                    <select name="recurrence_type" id="recurrence_type">
                                        <option value="daily" {% if todo.recurrence_type == 'daily' %}selected{% endif %}>ğŸ“… æ¯æ—¥</option>
                                        <option value="weekly" {% if todo.recurrence_type == 'weekly' %}selected{% endif %}>ğŸ“† æ¯é€±</option>
                                        <option value="monthly" {% if todo.recurrence_type == 'monthly' %}selected{% endif %}>ğŸ“Š æ¯æœˆ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="recurrence_end_date">çµ‚äº†æ—¥</label>
                                    <input
                                        type="date"
                                        name="recurrence_end_date"
                                        id="recurrence_end_date"
                                        value="{{ todo.recurrence_end_date }}"
                                    />
                                </div>
                            </div>
                        </div>

                        <!-- ãƒ¡ãƒ¢ -->
                        <div class="form-group">
                            <label for="memo">ğŸ’¬ ãƒ¡ãƒ¢</label>
                            <textarea 
                                name="memo" 
                                id="memo"
                                placeholder="è¿½åŠ ã®èª¬æ˜ã‚„ãƒ¡ãƒ¢ã‚’è¨˜å…¥..."
                            >{{ todo.memo }}</textarea>
                        </div>

                        <!-- ç¾åœ¨ã®ã‚¿ã‚°è¡¨ç¤º -->
                        {% if todo.tags %}
                        <div style="background-color: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--accent-blue);">
                            <strong style="color: var(--text-primary);">ğŸ“Œ ç¾åœ¨ã®ã‚¿ã‚°:</strong>
                            <div class="task-tags" style="margin-top: 10px;">
                                {% for tag in todo.tags.split(',') %}
                                {% if tag.strip() %}
                                <span class="tag">#{{ tag.strip() }}</span>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        <button type="submit">ğŸ’¾ ã‚¿ã‚¹ã‚¯ã‚’æ›´æ–°</button>
                    </form>
                </div>

                <div class="back-link">
                    <a href="{{ url_for('home') }}">â† ã‚¿ã‚¹ã‚¯ä¸€è¦§ã«æˆ»ã‚‹</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆæœŸåŒ–
        function initDarkMode() {
          const isDarkMode = localStorage.getItem('darkMode') === 'true';
          if (isDarkMode) {
            document.body.classList.add('dark-mode');
            updateDarkModeButton();
          }
        }

        // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleDarkMode() {
          document.body.classList.toggle('dark-mode');
          const isDarkMode = document.body.classList.contains('dark-mode');
          localStorage.setItem('darkMode', isDarkMode);
          updateDarkModeButton();
        }

        // ãƒœã‚¿ãƒ³æ›´æ–°
        function updateDarkModeButton() {
          const btn = document.getElementById('darkModeToggle');
          const isDarkMode = document.body.classList.contains('dark-mode');
          btn.textContent = isDarkMode ? 'â˜€ï¸ ãƒ©ã‚¤ãƒˆ' : 'ğŸŒ™ ãƒ€ãƒ¼ã‚¯';
        }

        // ç¹°ã‚Šè¿”ã—ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleRecurrenceOptions() {
            const isRecurring = document.getElementById('is_recurring').checked;
            const options = document.getElementById('recurrenceOptions');
            options.style.display = isRecurring ? 'block' : 'none';
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', initDarkMode);
    </script>
</body>
</html>