<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ã‚¿ã‚¹ã‚¯ç®¡ç†</title>
    <link rel="stylesheet" href="../static/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="header-container">
        <h1>ã‚¿ã‚¹ã‚¯ç®¡ç†</h1>
        <div class="user-actions">
          <a href="{{ url_for('logout') }}" class="logout-link">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
        </div>
      </div>

      {% with messages = get_flashed_messages() %} {% if messages %}
      <div class="flashes">
        {% for message in messages %}
        <div class="flash-message">{{ message }}</div>
        {% endfor %}
      </div>
      {% endif %} {% endwith %}

      <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
      <form method="GET" action="{{ url_for('home') }}" class="search-group">
        <input
          type="text"
          name="search"
          placeholder="ã‚¿ã‚¹ã‚¯ã¾ãŸã¯ã‚¿ã‚°ã§æ¤œç´¢"
          value="{{ search_query }}"
        />
        <button type="submit">æ¤œç´¢</button>
        {% if search_query %}
        <a
          href="{{ url_for('home') }}"
          style="
            padding: 12px 20px;
            background-color: #666;
            color: white;
            border-radius: 5px;
            text-decoration: none;
            display: flex;
            align-items: center;
          "
          >ãƒªã‚»ãƒƒãƒˆ</a
        >
        {% endif %}
      </form>

      <!-- ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
      <div class="add-form">
        <form method="POST" action="/add">
          <div class="form-row">
            <div class="form-group" style="flex: 2">
              <label for="title">ã‚¿ã‚¹ã‚¯åï¼ˆ#ã‚¿ã‚° ã‚’å«ã‚ã¦å…¥åŠ›å¯ï¼‰</label>
              <input
                type="text"
                name="title"
                id="title"
                placeholder="ä¾‹: è²·ã„ç‰© #è²·ã„ç‰© #ç·Šæ€¥"
                required
              />
            </div>
            <div class="form-group">
              <label for="due_date">æœŸé™æ—¥</label>
              <input type="date" name="due_date" id="due_date" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="priority">å„ªå…ˆåº¦</label>
              <select
                name="priority"
                id="priority"
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ddd;
                  border-radius: 3px;
                "
              >
                <option value="low">ğŸŸ¡ ä½</option>
                <option value="medium" selected>ğŸŸ  ä¸­</option>
                <option value="high">ğŸ”´ é«˜</option>
              </select>
            </div>
            <div class="form-group" style="flex: 1"></div>
          </div>

          <div class="form-group">
            <label for="memo">ãƒ¡ãƒ¢</label>
            <textarea
              name="memo"
              id="memo"
              placeholder="è¿½åŠ ã®èª¬æ˜ã‚„ãƒ¡ãƒ¢ã‚’è¨˜å…¥..."
            ></textarea>
          </div>

          <button type="submit" style="width: 100%; margin-top: 10px">
            ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 
          </button>
        </form>
      </div>

      <div class="task-list">
        <h2>æœªå®Œäº†ã®ã‚¿ã‚¹ã‚¯</h2>
        {% set incomplete = todo_list | selectattr('is_done', 'equalto', False)
        | list %} {% if incomplete %}
        <ul>
          {% for todo in incomplete %}
          <li>
            <div class="task-title">
              <div class="task-name">
                <span class="priority-badge priority-{{ todo.priority }}">
                  {% if todo.priority == 'high' %}ğŸ”´ é«˜{% elif todo.priority ==
                  'medium' %}ğŸŸ  ä¸­{% else %}ğŸŸ¡ ä½{% endif %}
                </span>
                {{ todo.title }}
              </div>

              {% if todo.due_date %}
              <div class="task-info">
                <span class="due-date-badge">ğŸ“… {{ todo.due_date }}</span>
              </div>
              {% endif %} {% if todo.memo %}
              <div class="task-memo">{{ todo.memo }}</div>
              {% endif %} {% if todo.tags %}
              <div class="task-tags">
                {% for tag in todo.tags.split(',') %} {% if tag.strip() %}
                <a
                  href="{{ url_for('home', search='#' + tag.strip()) }}"
                  class="tag"
                  >#{{ tag.strip() }}</a
                >
                {% endif %} {% endfor %}
              </div>
              {% endif %}
            </div>

            <div class="task-actions">
              <form
                method="POST"
                action="/complete/{{ todo.id }}"
                style="display: inline"
              >
                <button type="submit" class="complete-button">å®Œäº†</button>
              </form>
              <a href="{{ url_for('edit', todo_id=todo.id) }}" class="edit-link"
                >ç·¨é›†</a
              >
              <form
                method="POST"
                action="/delete/{{ todo.id }}"
                style="display: inline"
              >
                <button type="submit" class="delete-button">å‰Šé™¤</button>
              </form>
            </div>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="no-tasks">ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</p>
        {% endif %}
      </div>

      <div class="task-list">
        <h2>å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯</h2>
        {% set completed = todo_list | selectattr('is_done', 'equalto', True) |
        list %} {% if completed %}
        <ul>
          {% for todo in completed %}
          <li>
            <div class="task-title">
              <label style="cursor: pointer">
                <input
                  type="checkbox"
                  checked
                  disabled
                  style="margin-right: 8px"
                />
                <span
                  class="priority-badge priority-{{ todo.priority }}"
                  style="opacity: 0.6"
                >
                  {% if todo.priority == 'high' %}ğŸ”´ é«˜{% elif todo.priority ==
                  'medium' %}ğŸŸ  ä¸­{% else %}ğŸŸ¡ ä½{% endif %}
                </span>
                <span style="text-decoration: line-through; color: #aaa"
                  >{{ todo.title }}</span
                >
              </label>

              {% if todo.due_date %}
              <div class="task-info" style="opacity: 0.7">
                <span class="due-date-badge" style="opacity: 0.7"
                  >ğŸ“… {{ todo.due_date }}</span
                >
              </div>
              {% endif %} {% if todo.memo %}
              <div class="task-memo" style="opacity: 0.7">{{ todo.memo }}</div>
              {% endif %} {% if todo.tags %}
              <div class="task-tags">
                {% for tag in todo.tags.split(',') %} {% if tag.strip() %}
                <a
                  href="{{ url_for('home', search='#' + tag.strip()) }}"
                  class="tag"
                  style="opacity: 0.6"
                  >#{{ tag.strip() }}</a
                >
                {% endif %} {% endfor %}
              </div>
              {% endif %}
            </div>

            <div class="task-actions">
              <a href="{{ url_for('edit', todo_id=todo.id) }}" class="edit-link"
                >ç·¨é›†</a
              >
              <form
                method="POST"
                action="/delete/{{ todo.id }}"
                style="display: inline"
              >
                <button type="submit" class="delete-button">å‰Šé™¤</button>
              </form>
            </div>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="no-tasks">å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</p>
        {% endif %}
      </div>
    </div>
  </body>
</html>
